# This file was generated by ci-generate / CI::Gen
# (See https://github.com/shlomif/ci-gen-framework )
# Please do not edit directly.

addons:
    apt:
        packages:
            - ack-grep
            - asciidoc
            - build-essential
            - cmake
            - cmake-data
            - cpanminus
            - dbtoepub
            - docbook-defguide
            - docbook-xsl
            - docbook-xsl-ns
            - docbook5-xml
            - fortune-mod
            - gperf
            - graphicsmagick
            - hspell
            - hunspell
            - hunspell-en-gb
            - inkscape
            - libapr1-dev
            - libc6-dbg
            - libcmocka-dev
            - libdb5.3-dev
            - libgd-dev
            - libgdbm-compat-dev
            - libgdbm-dev
            - libgmp-dev
            - libgoogle-perftools-dev
            - libhunspell-dev
            - libncurses-dev
            - libpcre3-dev
            - libperl-dev
            - libtidy-dev
            - libxml2-dev
            - lynx
            - mercurial
            - myspell-he
            - ninja-build
            - optipng
            - perl
            - python3
            - python3-pip
            - python3-setuptools
            - silversearcher-ag
            - strip-nondeterminism
            - tidy
            - valgrind
            - wml
            - xsltproc
            - xvfb
            - xz-utils
            - zip
cache:
    directories:
        - $HOME/perl_modules
        - $HOME/tidyall_d

deploy:
    cleanup: true
    api_key:
        secure: OhF1yzK094w28DBR5I/UBzsAehylY9iU6Hfa3UsiPRUKu1IU+sf2ivvjECrSgauD3/zXY/MUB+136bG1vJ3MBjyzCPqh5gW+f2Qcq08whToVVozGbgfMjxtkdVkc83wiG3rUZLlI7qCbBVNV8qn8lpFLYVYvfV3XbWhFm3oUPQYzo8v9+WqZ53K7sQ2OWA6D/uv6xVoStZ4YwMU/lzAexwateTdsYjCKo0k5YzbW6kLlp4udiqaqn+pEFkWbD/K+mm62izDbwx+G9I41red11Rn93wuuhIS05bn8XBxStHa6zzeual6b98WPu1OFJPYBxkzxeC05CP1YyekVPrzVTkDPov53vZwfKfXc/k/wu9q2YYIij/YxDNfYO+afFTiBjlw++vnALOQET7p6BNBnnBsEi+Y1WatcqB1oor4YtjN5jinFtIImFvtVJXx8Qgwlw7DCsl5EcYpRuo8hkkSeEq8EtLTeR5VHFoABk0qacit/SZpLZ/kvv2plP4ezxcZ20Tt4phLsEMxhHqysJyYSBp1AMRk+czfE81B+2mNazMloeQXGvcwoMY6+JoDWtudc0afd5dQGKxf1/c2Yh8AkTmEBMNC9nktReaU3QQcS5vL9Ne75RFmgMwcqphwezm1TvQz0/KD/y7JgvaGLI2/bc8hRVGjyI6KUu/0lE/GvEEg=
    file: site-dest.tar.xz
    on:
        repo: "shlomif/shlomi-fish-homepage"
        tags: true
    provider: releases
go:
    - "1.16.x"
os: linux
dist: focal
rvm:
    - 2.7.0
before_install:
    # Taken from https://github.com/brad/Inkscape-OpenSCAD-DXF-Export/blob/master/.travis.yml
    # Thanks!
    # - "export DISPLAY=:99.0"
    # - "sh -e /etc/init.d/xvfb start"
    - . .travis.bash --cmd before_install
install:
    - git clone https://github.com/vim/vim && ( cd vim && git checkout v8.2.1320 && ./configure --with-features=huge && make && sudo make install ) && rm -fr vim
    # Taken from https://github.com/brad/Inkscape-OpenSCAD-DXF-Export/blob/master/.travis.yml
    # Thanks!
    - sudo add-apt-repository -y ppa:inkscape.dev/stable
    - sudo apt-get update -qq
    - sudo apt-get --only-upgrade install libnss3
    - sudo apt-get install -qq inkscape
script:
    # Taken from https://dev.to/hiro98/how-to-use-the-systemd-userspace-dbus-api-on-traivis-ci-lag
    # Thanks!
    - sudo apt update
    - sudo apt install dbus-user-session
    - systemctl --user start dbus
    - export DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u)/bus
    - export XML_CATALOG_FILES="/etc/xml/catalog $HOME/markup-validator/htdocs/sgml-lib/catalog.xml"
    - TIDYALL_DATA_DIR="$HOME/tidyall_d" bash -x bin/run-ci-build.bash
    - tar -caf site-dest.tar.xz dest/
    - set +x
services:
    - xvfb
