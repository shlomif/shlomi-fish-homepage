<HTML>
<head>
<title>PostgreSQL - C Program</title>
</head>
<BODY BGcolor=#FFFFFF TEXT=#000000>

<h1>Same Program in C</h1>

<PRE>
<FONT color=#a620f7>#include </FONT><FONT color=#ff00ff>&lt;stdio.h&gt;</FONT>
<FONT color=#a620f7>#include </FONT><FONT color=#ff00ff>&quot;libpq-fe.h&quot;</FONT>

<B><FONT color=#288a51>void</FONT></B>
exit_nicely(PGconn * conn)
{
    PQfinish(conn);
    exit(<FONT color=#ff00ff>1</FONT>);
}

<B><FONT color=#288a51>int</FONT></B> main()
{
    <B><FONT color=#288a51>char</FONT></B> * pghost, * pgport, * pgoptions, * pgtty;
    <B><FONT color=#288a51>char</FONT></B> * dbName;

    <B><FONT color=#288a51>char</FONT></B> name[<FONT color=#ff00ff>256</FONT>];

    <B><FONT color=#288a51>int</FONT></B> i, num_records;

    PGconn * conn;
    PGresult * res;

    pghost = <FONT color=#ff00ff>NULL</FONT>;
    pgport = <FONT color=#ff00ff>NULL</FONT>;
    pgoptions = <FONT color=#ff00ff>NULL</FONT>;
    pgtty = <FONT color=#ff00ff>NULL</FONT>;
    
    dbName = <FONT color=#ff00ff>&quot;test&quot;</FONT>;

    conn = PQsetdb(pghost, pgport, pgoptions, pgtty, dbName);

    <B><FONT color=#a62828>if</FONT></B> (PQstatus(conn) == CONNECTION_BAD)
    {
        fprintf(<FONT color=#ff00ff>stderr</FONT>, <FONT color=#ff00ff>&quot;Connection to database </FONT><FONT color=#6959cf>\&quot;</FONT><FONT color=#6959cf>%s</FONT><FONT color=#6959cf>\&quot;</FONT><FONT color=#ff00ff> failed.</FONT><FONT color=#6959cf>\n</FONT><FONT color=#ff00ff>&quot;</FONT>, dbName);
        fprintf(<FONT color=#ff00ff>stderr</FONT>, <FONT color=#ff00ff>&quot;</FONT><FONT color=#6959cf>%s</FONT><FONT color=#ff00ff>&quot;</FONT>, PQerrorMessage(conn));
        exit_nicely(conn);
    }

    res = PQexec(conn, <FONT color=#ff00ff>&quot;SET DateStyle = 'European'&quot;</FONT>);

    <B><FONT color=#a62828>if</FONT></B> ((!res) || (PQresultStatus(res) != PGRES_COMMAND_OK))
    {
        fprintf(<FONT color=#ff00ff>stderr</FONT>, <FONT color=#ff00ff>&quot;SET command failed</FONT><FONT color=#6959cf>\n</FONT><FONT color=#ff00ff>&quot;</FONT>);
        PQclear(res);
        exit_nicely(conn);
    }
    PQclear(res);

    res = PQexec(conn, 
        <FONT color=#ff00ff>&quot;SELECT first_name, last_name, hired_at&quot;</FONT>
        <FONT color=#ff00ff>&quot; FROM employees&quot;</FONT>
        <FONT color=#ff00ff>&quot; ORDER BY last_name, first_name&quot;</FONT>
    );
    <B><FONT color=#a62828>if</FONT></B> ((!res) || (PQresultStatus(res) != PGRES_TUPLES_OK))
    {
        fprintf(<FONT color=#ff00ff>stderr</FONT>, <FONT color=#ff00ff>&quot;SELECT command did not return tuples properly</FONT><FONT color=#6959cf>\n</FONT><FONT color=#ff00ff>&quot;</FONT>);
        PQclear(res);
        exit_nicely(conn);
    }

    printf(<FONT color=#ff00ff>&quot;</FONT><FONT color=#6959cf>%-40s%-20s</FONT><FONT color=#6959cf>\n</FONT><FONT color=#ff00ff>&quot;</FONT>, <FONT color=#ff00ff>&quot;Name:&quot;</FONT>, <FONT color=#ff00ff>&quot;Hired At:&quot;</FONT>);
    <B><FONT color=#a62828>for</FONT></B>(i=<FONT color=#ff00ff>0</FONT>;i&lt;<FONT color=#ff00ff>60</FONT>;i++)
    {
        printf(<FONT color=#ff00ff>&quot;-&quot;</FONT>);
    }
    printf(<FONT color=#ff00ff>&quot;</FONT><FONT color=#6959cf>\n</FONT><FONT color=#ff00ff>&quot;</FONT>);

    num_records = PQntuples(res);

    <B><FONT color=#a62828>for</FONT></B>(i = <FONT color=#ff00ff>0</FONT> ; i &lt; num_records ; i++)
    {
        sprintf(name, <FONT color=#ff00ff>&quot;</FONT><FONT color=#6959cf>%s</FONT><FONT color=#ff00ff> </FONT><FONT color=#6959cf>%s</FONT><FONT color=#ff00ff>&quot;</FONT>, PQgetvalue(res, i, <FONT color=#ff00ff>0</FONT>), PQgetvalue(res, i, <FONT color=#ff00ff>1</FONT>));
        printf(<FONT color=#ff00ff>&quot;</FONT><FONT color=#6959cf>%-40s%-20s</FONT><FONT color=#6959cf>\n</FONT><FONT color=#ff00ff>&quot;</FONT>, name, PQgetvalue(res, i, <FONT color=#ff00ff>2</FONT>));
    }

    PQclear(res);

    PQfinish(conn);

    <B><FONT color=#a62828>return</FONT></B> <FONT color=#ff00ff>0</FONT>;

}

    
            

    

</PRE>
</BODY>
</HTML>
