all: dist test

VER = 0.2.6

DIST_BASE = fortunes-shlomif

DIST_DIR = $(DIST_BASE)-$(VER)

PACKAGE_BASE = $(DIST_DIR).tar.gz

FILES = shlomif shlomif-fav friends tinic osp_rules joel-on-software

DATS = $(addsuffix .dat,$(FILES))

$(DATS):: %.dat : %
	/usr/sbin/strfile $<

test: $(DATS)
	@fortune -e $(addprefix ./,$(FILES))

dist: $(PACKAGE_BASE)

$(PACKAGE_BASE): $(DATS)
	mkdir $(DIST_DIR)
	cp $(FILES) $(DATS) $(DIST_DIR)
	tar -czvf $(PACKAGE_BASE) $(DIST_DIR)
	cat index.html | sed '/%%PACKAGE_BASE%%/ s/href=".*"/href="$(PACKAGE_BASE)"/' > index.html.new
	mv -f index.html.new index.html
	rm -fr $(DIST_DIR)
