os: linux
dist: trusty
before_install:
    - sudo apt-get update -qq
    - sudo apt-get install -y ack-grep asciidoc build-essential cmake cpanminus dbtoepub docbook-defguide docbook-xsl docbook-xsl-ns fortune-mod hunspell inkscape myspell-en-gb libhunspell-dev libperl-dev optipng perl python3 python3-setuptools python3-pip valgrind wml xsltproc xz-utils yui-compressor zip
    - sudo ln -s /usr/bin/yui-compressor /usr/bin/yuicompressor
    - sudo -H `which python3` -m pip install bs4
    - sudo -H `which python3` -m pip install beautifulsoup4
    - sudo dpkg-divert --local --divert /usr/bin/ack --rename --add /usr/bin/ack-grep
    - sudo cpanm --notest Alien::Tidyp YAML::XS
    - "sudo cpanm --notest $(perl -MYAML::XS=LoadFile -e 'print join q( ), sort {$a cmp $b} keys(%{LoadFile(q(bin/required-modules.yml))->{required}->{modules}})')"
    - gem install sass compass compass-blueprint
    - bash bin/install-git-cmakey-program-system-wide.bash 'git' 'installer' 'https://github.com/thewml/latemp.git'
    - ( cd .. && hg clone https://shlomif@bitbucket.org/shlomif/wml-extended-apis && cd wml-extended-apis/xhtml/1.x && bash Install.bash )
    - ( cd .. && hg clone https://shlomif@bitbucket.org/shlomif/wml-affiliations && cd wml-affiliations/wml && bash Install.bash )
    - ( cd .. && hg clone https://shlomif@bitbucket.org/shlomif/latemp && cd latemp/support-headers && perl install.pl )
    - bash -x bin/install-tidyp-systemwide.bash
    - bash bin/install-git-cmakey-program-system-wide.bash 'hg' 'installer' 'https://bitbucket.org/shlomif/quad-pres'
    - echo '{"amazon_sak":"invalid"}' > "$HOME"/.shlomifish-amazon-sak.json
    - ( cd "$HOME" && git clone https://github.com/w3c/markup-validator.git )
    - pwd
    - echo "HOME=$HOME"
    - find ~/conf
    - touch t2/philosophy/SummerNSA/Letter-to-SGlau-2014-10/*.{html,pdf}
    - npm install html-minifier
python:
    - "3.5"
script: "bash -x bin/travis-ci-script.bash"
